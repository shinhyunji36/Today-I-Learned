> **일시**: 2023년 01월 19일 목 `18:00` ~ `20:45`

## [널널한 개발자 Youtube](https://www.youtube.com/watch?v=gOMljj6K2V0&list=PLXvgR_grOs1BFH-TuqFsfHqbh-gpMbFoy&index=5) 
- 네트워크 기초 강의 05. 개발자 입장에서 Port번호 이해하기
- 아이패드 굿노트 필기

## [쉬운 코드 Youtube](https://www.youtube.com/watch?v=QmtYKZC0lMU&list=PLcXyemr8ZeoQOtSUjwaer0VMJSMfa-9G-) 
- 운영체제 강의 02. 컨텍스트 스위칭 뽀개기! 의미와 종류와 왜 스레드 컨텍스트 스위칭이 더 빠르다고 하는지까지..! 이 모든 것을 시원~\~하게 설명합니다!!
### 컨텍스트 스위칭 (context switching) 
- CPU 코어에서 실행중이던 프로세스/스레드가 다른 프로세스/스레드로 교체되는 것
- 오늘날 컴퓨터에서는 하나의 프로세스에 기본적으로 하나의 스레드가 존재
  - 왜냐면 스레드가 CPU/Core에서 실행되는 기본 단위 이기 때문
- 그래서 엄밀히 말하면, 하나의 프로세스에서 다른 프로세스로 스위칭 되는 것은 서로 서로 다른 프로세스에 속한 스레드들 끼리 스위칭되는 것.
  - 일단은, 프로세스가 다른 프로세스로 교체된다고 말할 것!
-
### 컨텍스트란?
- 프로세스/스레드의 상태
- CPU에서의 상태, 메모리에서의 상태 등등
  - 특히 CPU에는 기본적으로 레지스터(register)가 존재. e.g. 프로그램 카운터, ..

### 컨텍스트 스위칭은 왜 필요할까?
- 여러 프로세스/스레드를 동시에 실행시키고 싶으니까!~

### 컨텍스트 스위칭은 언제 발생하나?
- 주어진 time slice(quantum: 아주 작은 time slice)를 다 사용했거나
- IO 작업을 해야하거나
- 다른 리소스를 기다려야하거나..

### 컨텍스트 스위칭은 누구에 의해 실행되는가?
- 컨텍스트 스위칭을 총괄해서 처음부터 끝까지 수행하는/집행시키는 주체
- OS(운영체제)의 커널
  - 운영체제에서도 가장 핵심적인 기능을 담당하는 커널.
  - e.g. cpu, memory, disk drive 등 여러 리소스를 관리 감독
- 각종 리소스를 관리/감독하는 역할

### 컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?
- `다른 프로세스끼리 스위칭`(Process Context Switching)인지, 
- `같은 프로세스의 스레들끼리 스위칭`(Thread Context Switching)인지에 따라 다르다.

### 그렇다면 둘의 공통점은 무엇인가? (`다른 프로세스끼리 스위칭` & `같은 프로세스의 스레들끼리 스위칭`)
1. 커널 모드에서 실행
  - 프로세스가 계속 실행되다가, 하드웨어와 밀접한 일들 혹은 리소스를 많이 다뤄야하는 상황이 오면 이 때, 프로세스가 직접 리소스에 접근하지 않고, 운영체제를 통해서 접근하게 된다. 특히 운영체제 중에서도 이 커널에 의해 실행되는 것을 커널 모드라고 한다. 
2. CPU의 레지스터 상태를 교체
  - 레지스터: CPU에 여러 레지스터 존재. 각종 명령어들을 수행하기 위해 필요한 여러 데이터를 저장하는 존재
  - Process 1이 CPU에서 실행되고 있는 중에 다른 Process 2가 실행하면
    - 먼저 실행되고 있던 Process 1의 레지스터 상태들을 어디다 저장하고, Process 2를 실행하게 된다.
  - 왜 저장하나? 그래야지 Process 2 이후에 Process 1 을 다시 실행하는 경우 어디까지 실행되었는지, 그리고 실행 시 상태가 어떻게 되었는지 알고 있어야 다시 이어서 실행할 수 있기 때문.

### 그렇다면 둘의 차이점은? (`다른 프로세스끼리 스위칭` & `같은 프로세스의 스레들끼리 스위칭`)
- 프로세스 컨텍스트 스위칭은 가상(virtual) 메모리 주소 관련 처리를 추가로 수행한다.
  - 왜냐하면 다른 프로세스 끼리는 메모리 주소체계가 다르기 때문에, 프로세스 컨텍스트 스위칭 시에는 메모리에 관련된 처리를 추가로 수행해줘야 한다.
  - 그래서 `MMU`라고 하는 memory manage unit도 새로운 프로세스의 메모리 주소체계를 바라볼 수 있도록 수정해줘야.
  - `TLB`(가상 메모리 주소와 실제 물리적인 주소의 매핑정보를 들고 있는 캐시역할을 한다)도 비워줘야 한다.

### 스레드 컨텍스트 스위칭이 더 빠른 이유는?- 
- 같은 프로세스에 속한 스레드끼리의 스위칭
- 이 경우엔 같은 메모리 공간을 공유하기 때문에 메모리 주소 관련 처리는 따로 해줄 필요가 없다
  - 스레드 컨텍스트 스위칭은 CPU의 상태 정도만 바꿔주면 된다.
- 즉, 메모리 주소 관련 처리를 하지 않기 때문에! 그만큼 시간이 덜 든다.

### 컨텍스트 스위칭이 미치는 간접적인 영향은?
- 캐시 오염 (cache pollution) 발생
  - CPU안에는 기본적으로 Cache라는 것이 있다. 
  - CPU는 메모리와 데이터를 주고받는데, 자주 쓸 거 같은 것들은 cache에 올려놓고 메모리로 직접 데이터를 찾으러 가는 대신 cpu 옆에 붙어있는 cache에 저장해놓고 옆으로 찾으러 간다. (더 빠름)
  - 프로세스 컨텍스트 스위칭 시 발생 문제
    - 문제는 컨텍스트 스위칭 하는 프로세스들은 서로 다른 데이터를 갖고 있기 때문에 cache가 오염이 된다.
    - 컨텍스트 스위칭이 된 이후 cache에 가봤자 어차피 이전 프로세스의 전혀 다른 데이터를 갖고 있음... 내가(현재 실행 프로세스) 현재 필요한 정보 없을 가능성 매우 높음
    - cache로 정보 찾으러 갔다가, 없는 걸 확인하고 메모리로 다시 건너가야하기 때문에 처리 속도가 느려지므로, 성능이 
    - 그래서 프로세스 컨텍스트 스위칭 시에 cache를 날려버리는 정책을 채택하는 경우도 있음.    
  - 스레드 컨텍스트 스위칭 시 
    - 같은 프로세스에 속한 스레드들 끼리의 컨텍스트 스위칭이므로
    - 같은 메모리 영역 공유하고 있음. 
    - 따라서 컨텍스트 스위칭 이후에도 내가(현재 실행 스레드) 찾는 정보가 cache에 있을 가능성 높아짐


### 유저 관점에서 컨텍스트 스위칭이란?
- 순수한(pure) 오버헤드(overhead)
- 그냥 내가 실행한 프로그램의 동작이랑은 전혀 관계 없는.. gpu 잡아먹는 오버헤드..?
- 컨텍스트 스위칭이 자주 일어나는 것은 따라서 좋지 않다.



